[build]
builder = "NIXPACKS"
buildCommand = "npm run build"
startCommand = "npm start"

[deploy]
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3
healthcheckPath = "/api/health"
healthcheckTimeout = 100

[environments]
  [environments.production]
    variables = [
      "NODE_ENV=production",
      "NEXT_PUBLIC_API_BASE_URL=https://invoicing-api-production.up.railway.app/api",
      "NEXTAUTH_URL=https://invoicing-system-production.up.railway.app",
      "NEXTAUTH_SECRET=${{secrets.NEXTAUTH_SECRET}}",
      "DATABASE_URL=${{Postgres.DATABASE_URL}}"
    ]

[service]
name = "invoicing-system"
type = "web"

[nixpacks]
# Use Node.js 18 for better compatibility
providers = ["node"]
nodeVersion = "18"